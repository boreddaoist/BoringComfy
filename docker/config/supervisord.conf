[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
logfile_maxbytes=50MB
logfile_backups=10

[program:comfyui]
command=python3 /app/main.py --listen --port 8188
directory=/app
stdout_logfile=/var/log/supervisor/comfyui.log
stderr_logfile=/var/log/supervisor/comfyui.err
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=30
environment=PYTHONUNBUFFERED=1,CUDA_VISIBLE_DEVICES=all
priority=1

[program:jupyter]
command=jupyter lab --config=/root/config/jupyter_server_config.py
directory=/app
stdout_logfile=/var/log/supervisor/jupyter.log
stderr_logfile=/var/log/supervisor/jupyter.err
autostart=true
autorestart=true
startsecs=10
stopwaitsecs=30
environment=PYTHONUNBUFFERED=1
priority=2

[program:ttyd]
command=ttyd -p 7681 bash
stdout_logfile=/var/log/supervisor/ttyd.log
stderr_logfile=/var/log/supervisor/ttyd.err
autostart=true
autorestart=true
priority=3

[group:services]
programs=comfyui,jupyter,ttyd
priority=999